require('rstan')
library(here)
library(tidyverse)
library(brms)
library(bayesplot)
library(ggmcmc)
library(patchwork)
library(priorsense)
load(
file = here("Presentations", "MarathonData.RData")
)
MarathonTimes_Mod2 <-
readRDS(file =
here("Presentations",
"Output",
"MarathonTimes_Mod2.RDS")
)
# Setting a plotting theme
theme_set(theme_linedraw() +
theme(text = element_text(family = "Times", size = 10),
panel.grid = element_blank())
)
knitr::include_graphics("Priors_Mod2.jpg")
#| echo: true
#| output-location: slide
set.seed(1975)
pp_check(
Fit_Model_priors,
ndraws = 300) # number of simulated datasets you wish for
library(here)
library(tidyverse)
library(brms)
library(bayesplot)
library(ggmcmc)
library(patchwork)
library(priorsense)
load(
file = here("Presentations", "MarathonData.RData")
)
MarathonTimes_Mod2 <-
readRDS(file =
here("Presentations",
"Output",
"MarathonTimes_Mod2.RDS")
)
# Setting a plotting theme
theme_set(theme_linedraw() +
theme(text = element_text(family = "Times", size = 10),
panel.grid = element_blank())
)
knitr::include_graphics("Priors_Mod2.jpg")
#| message: false
#| warning: false
#| error: false
#| echo: true
#| output-location: slide
#| fig-cap: "Probability density plots for the different priors used in the example model"
#| fig-cap-location: margin
#| cache: true
library(metRology)
library(ggplot2)
library(ggtext)
library(patchwork)
# Setting a plotting theme
theme_set(theme_linedraw() +
theme(text = element_text(family = "Times", size = 8),
panel.grid = element_blank(),
plot.title = element_markdown())
)
# Generate the plot for the prior of the Intercept (mu)
Prior_mu <- ggplot( ) +
stat_function(
fun = dt.scaled,    # We use the dt.scaled function of metRology
args = list(df = 3, mean = 199.2, sd = 24.9), #
xlim = c(120,300)
) +
scale_y_continuous(name = "density") +
labs(title = "Prior for the intercept",
subtitle = "student_t(3,199.2,24.9)")
# Generate the plot for the prior of the error variance (sigma)
Prior_sigma <- ggplot( ) +
stat_function(
fun = dt.scaled,    # We use the dt.scaled function of metRology
args = list(df = 3, mean = 0, sd = 24.9), #
xlim = c(0,6)
) +
scale_y_continuous(name = "density") +
labs(title = "Prior for the residual variance",
subtitle = "student_t(3,0,24.9)")
# Generate the plot for the prior of the effects of independent variables
Prior_betas <- ggplot( ) +
stat_function(
fun = dnorm,    # We use the normal distribution
args = list(mean = 0, sd = 10), #
xlim = c(-20,20)
) +
scale_y_continuous(name = "density") +
labs(title = "Prior for the effects of independent variables",
subtitle = "N(0,10)")
Prior_mu + Prior_sigma + Prior_betas +
plot_layout(ncol = 3)
# Generate the plot for the prior of the Intercept (mu)
Prior_mu <- ggplot( ) +
stat_function(
fun = dnorm,    # We use a normal distribution
args = list(mean = 0, sd = .5), #
xlim = c(-1,1)
) +
scale_y_continuous(name = "density") +
labs(title = "Prior for the intercept",
subtitle = "N(0,0.5)")
Prior_mu
# Generate the plot for the prior of beta 1
Prior_beta1 <- ggplot( ) +
stat_function(
fun = dnorm,    # We use the dt.scaled function of metRology
args = list(mean = 1, sd = 0.5), #
xlim = c(-1,3)
) +
scale_y_continuous(name = "density") +
labs(title = "Prior for the effect of pretest score",
subtitle = "N(1,0.5)")
Prior_beta1
# Generate the plot for the prior of the effects experimental conditions
Prior_betas <- ggplot( ) +
stat_function(
fun = dnorm,    # We use the normal distribution
args = list(mean = 0.2, sd = .6), #
xlim = c(-1,2)
) +
scale_y_continuous(name = "density") +
labs(title = "Prior for the effects of experimental conditions",
subtitle = "N(0.2,0.6)")
Prior_betas
#| message: false
#| warning: false
#| error: false
#| echo: true
#| cache: true
Custom_priors <-
c(
set_prior(
"normal(0,10)",
class = "b",
coef = "km4week"),
set_prior(
"normal(0,10)",
class = "b",
coef = "sp4week")
)
Fit_Model_priors <- readRDS(
here(
"Presentations",
"Output",
"Fit_Model_priors.RDS"
)
)
#| echo: true
#| output-location: slide
set.seed(1975)
pp_check(
Fit_Model_priors,
ndraws = 300) # number of simulated datasets you wish for
#| echo: true
#| output-location: slide
pp_check(Fit_Model_priors,
type = "stat",
stat = "median")
#| fig-cap: "Caterpillar plots for the parameters in the model"
#| fig-cap-location: margin
#| output-location: slide
#| cache: true
#| echo: true
#| warning: false
Model_chains <- ggs(MarathonTimes_Mod2)
Model_chains %>%
filter(Parameter %in% c(
"b_Intercept",
"b_km4week",
"b_sp4week",
"sigma"
)
) %>%
ggplot(aes(
x   = Iteration,
y   = value,
col = as.factor(Chain)))+
geom_line() +
facet_grid(Parameter ~ .,
scale  = 'free_y',
switch = 'y') +
labs(title = "Caterpillar Plots for the parameters",
col   = "Chains")
library(brms)
library(tidyverse)
load(
file = here(
"Presentations",
"WritingData.RData")
)
library(here)
load(
file = here(
"Presentations",
"WritingData.RData")
)
M3 <- brm(
SecondVersion ~ FirstVersion_GM + Experimental_condition + (1 + FirstVersion_GM |Class),
data = WritingData,
backend = "cmdstanr",
cores = 4,
control = list(adapt_delta = 0.9),
seed = 1975
)
View(WritingData)
#
summary(WritingData$Condition)
WritingData <- WritingData %>%
mutate(
Control_Condition =
case_when(
Condition == 1 ~ 1,
Condition == 2 ~ 0
)
)
View(WritingData)
WritingData <- WritingData %>%
mutate(
Control_Condition =
case_when(
Condition == 2 ~ 1,
Condition == 1 ~ 0
)
)
View(WritingData)
M_alternative <- brm(
SecondVersion ~ -1 + Control_Condition + Experimental_condition + (-1 + Control_Condition + Experimental_condition |Class),
data = WritingData,
backend = "cmdstanr",
cores = 4,
control = list(adapt_delta = 0.9),
seed = 1975
)
summary(M_alternative)
M_alternative <- brm(
SecondVersion ~ -1 + Control_Condition + Experimental_condition + (1 |Class),
data = WritingData,
backend = "cmdstanr",
cores = 4,
control = list(adapt_delta = 0.9),
seed = 1975
)
summary(M_alternative)
